<form action="/save-theme" method="POST" id="save-theme-form">
    <div class="row">
        <div class="section"></div>
        <div class="col s12 m12 l6">
            <h3 class="white-text no-top-padding">Choose Editor Theme</h3>
        </div>

        <div class="col s12 m12 l6 input-field">
            <select class="btn-border-purple" name="theme" id="theme" onchange="updateTheme()">
                {% if session['editor_theme'] == 'seti' %}
                <option value="seti" selected>VirtualZero</option>
                {% else %}
                <option value="seti">VirtualZero</option>
                {% endif %}

                {% if session['editor_theme'] == '3024-day' %}
                <option value="3024-day" selected>3024 Day</option>
                {% else %}
                <option value="3024-day">3024 Day</option>
                {% endif %}

                {% if session['editor_theme'] == '3024-night' %}
                <option value="3024-night" selected>3024 Night</option>
                {% else %}
                <option value="3024-night">3024 Night</option>
                {% endif %}

                {% if session['editor_theme'] == 'abcdef' %}
                <option value="abcdef" selected>ABCDEF</option>
                {% else %}
                <option value="abcdef">ABCDEF</option>
                {% endif %}

                {% if session['editor_theme'] == 'ambiance-mobile' %}
                <option value="ambiance-mobile" selected>Ambiance Mobile</option>
                {% else %}
                <option value="ambiance-mobile">Ambiance Mobile</option>
                {% endif %}

                {% if session['editor_theme'] == 'ambiance' %}
                <option value="ambiance" selected>Ambiance</option>
                {% else %}
                <option value="ambiance">Ambiance</option>
                {% endif %}

                {% if session['editor_theme'] == 'base16-dark' %}
                <option value="base16-dark" selected>Base16 Dark</option>
                {% else %}
                <option value="base16-dark">Base16 Dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'base16-light' %}
                <option value="base16-light" selected>Base16 Light</option>
                {% else %}
                <option value="base16-light">Base16 Light</option>
                {% endif %}

                {% if session['editor_theme'] == 'bespin' %}
                <option value="bespin" selected>Bespin</option>
                {% else %}
                <option value="bespin">Bespin</option>
                {% endif %}

                {% if session['editor_theme'] == 'blackboard' %}
                <option value="blackboard" selected>Blackboard</option>
                {% else %}
                <option value="blackboard">Blackboard</option>
                {% endif %}

                {% if session['editor_theme'] == 'cobalt' %}
                <option value="cobalt" selected>Cobalt</option>
                {% else %}
                <option value="cobalt">Cobalt</option>
                {% endif %}

                {% if session['editor_theme'] == 'colorforth' %}
                <option value="colorforth" selected>Colorforth</option>
                {% else %}
                <option value="colorforth">Colorforth</option>
                {% endif %}

                {% if session['editor_theme'] == 'darcula' %}
                <option value="darcula" selected>Darcula</option>
                {% else %}
                <option value="darcula">Darcula</option>
                {% endif %}

                {% if session['editor_theme'] == 'dracula' %}
                <option value="dracula" selected>Dracula</option>
                {% else %}
                <option value="dracula">Dracula</option>
                {% endif %}

                {% if session['editor_theme'] == 'duotone-dark' %}
                <option value="duotone-dark" selected>Duotone-dark</option>
                {% else %}
                <option value="duotone-dark">Duotone-dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'duotone-light' %}
                <option value="duotone-light" selected>Duotone-light</option>
                {% else %}
                <option value="duotone-light">Duotone-light</option>
                {% endif %}

                {% if session['editor_theme'] == 'eclipse' %}
                <option value="eclipse" selected>Eclipse</option>
                {% else %}
                <option value="eclipse">Eclipse</option>
                {% endif %}

                {% if session['editor_theme'] == 'elegant' %}
                <option value="elegant" selected>Elegant</option>
                {% else %}
                <option value="elegant">Elegant</option>
                {% endif %}

                {% if session['editor_theme'] == 'erlang-dark' %}
                <option value="erlang-dark" selected>Erlang-dark</option>
                {% else %}
                <option value="erlang-dark">Erlang-dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'gruvbox-dark' %}
                <option value="gruvbox-dark" selected>Gruvbox-dark</option>
                {% else %}
                <option value="gruvbox-dark">Gruvbox-dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'hopscotch' %}
                <option value="hopscotch" selected>Hopscotch</option>
                {% else %}
                <option value="hopscotch">Hopscotch</option>
                {% endif %}

                {% if session['editor_theme'] == 'icecoder' %}
                <option value="icecoder" selected>Icecoder</option>
                {% else %}
                <option value="icecoder">Icecoder</option>
                {% endif %}

                {% if session['editor_theme'] == 'idea' %}
                <option value="idea" selected>Idea</option>
                {% else %}
                <option value="idea">Idea</option>
                {% endif %}

                {% if session['editor_theme'] == 'isotope' %}
                <option value="isotope" selected>Isotope</option>
                {% else %}
                <option value="isotope">Isotope</option>
                {% endif %}

                {% if session['editor_theme'] == 'lesser-dark' %}
                <option value="lesser-dark" selected>Lesser Dark</option>
                {% else %}
                <option value="lesser-dark">Lesser Dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'liquibyte' %}
                <option value="liquibyte" selected>Liquibyte</option>
                {% else %}
                <option value="liquibyte">Liquibyte</option>
                {% endif %}

                {% if session['editor_theme'] == 'lucario' %}
                <option value="lucario" selected>Lucario</option>
                {% else %}
                <option value="lucario">Lucario</option>
                {% endif %}

                {% if session['editor_theme'] == 'material' %}
                <option value="material" selected>Material</option>
                {% else %}
                <option value="material">Material</option>
                {% endif %}

                {% if session['editor_theme'] == 'mbo' %}
                <option value="mbo" selected>MBO</option>
                {% else %}
                <option value="mbo">MBO</option>
                {% endif %}

                {% if session['editor_theme'] == 'mdn-like' %}
                <option value="mdn-like" selected>MDN Like</option>
                {% else %}
                <option value="mdn-like">MDN Like</option>
                {% endif %}

                {% if session['editor_theme'] == 'midnight' %}
                <option value="midnight" selected>Midnight</option>
                {% else %}
                <option value="midnight">Midnight</option>
                {% endif %}

                {% if session['editor_theme'] == 'monokai' %}
                <option value="monokai" selected>Monokai</option>
                {% else %}
                <option value="monokai">Monokai</option>
                {% endif %}

                {% if session['editor_theme'] == 'neat' %}
                <option value="neat" selected>Neat</option>
                {% else %}
                <option value="neat">Neat</option>
                {% endif %}

                {% if session['editor_theme'] == 'neo' %}
                <option value="neo" selected>Neo</option>
                {% else %}
                <option value="neo">Neo</option>
                {% endif %}

                {% if session['editor_theme'] == 'night' %}
                <option value="night" selected>Night</option>
                {% else %}
                <option value="night">Night</option>
                {% endif %}

                {% if session['editor_theme'] == 'oceanic-next' %}
                <option value="oceanic-next" selected>Oceanic-next</option>
                {% else %}
                <option value="oceanic-next">Oceanic-next</option>
                {% endif %}

                {% if session['editor_theme'] == 'panda-syntax' %}
                <option value="panda-syntax" selected>Panda Syntax</option>
                {% else %}
                <option value="panda-syntax">Panda Syntax</option>
                {% endif %}

                {% if session['editor_theme'] == 'paraiso-dark' %}
                <option value="paraiso-dark" selected>Paraiso Dark</option>
                {% else %}
                <option value="paraiso-dark">Paraiso Dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'paraiso-light' %}
                <option value="paraiso-light" selected>Paraiso Light</option>
                {% else %}
                <option value="paraiso-light">Paraiso Light</option>
                {% endif %}

                {% if session['editor_theme'] == 'pastel-on-dark' %}
                <option value="pastel-on-dark" selected>Pastel On Dark</option>
                {% else %}
                <option value="pastel-on-dark">Pastel On Dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'railscasts' %}
                <option value="railscasts" selected>Railscasts</option>
                {% else %}
                <option value="railscasts">Railscasts</option>
                {% endif %}

                {% if session['editor_theme'] == 'rubyblue' %}
                <option value="rubyblue" selected>Rubyblue</option>
                {% else %}
                <option value="rubyblue">Rubyblue</option>
                {% endif %}

                {% if session['editor_theme'] == 'shadowfox' %}
                <option value="shadowfox" selected>Shadowfox</option>
                {% else %}
                <option value="shadowfox">Shadowfox</option>
                {% endif %}

                {% if session['editor_theme'] == 'solarized' %}
                <option value="solarized" selected>Solarized</option>
                {% else %}
                <option value="solarized">Solarized</option>
                {% endif %}

                {% if session['editor_theme'] == 'ssms' %}
                <option value="ssms" selected>SSMS</option>
                {% else %}
                <option value="ssms">SSMS</option>
                {% endif %}

                {% if session['editor_theme'] == 'the-matrix' %}
                <option value="the-matrix" selected>The Matrix</option>
                {% else %}
                <option value="the-matrix">The Matrix</option>
                {% endif %}

                {% if session['editor_theme'] == 'tomorrow-night-bright' %}
                <option value="tomorrow-night-bright" selected>Tomorrow Night Bright</option>
                {% else %}
                <option value="tomorrow-night-bright">Tomorrow Night Bright</option>
                {% endif %}

                {% if session['editor_theme'] == 'tomorrow-night-eighties' %}
                <option value="tomorrow-night-eighties" selected>Tomorrow Night Eighties</option>
                {% else %}
                <option value="tomorrow-night-eighties">Tomorrow Night Eighties</option>
                {% endif %}

                {% if session['editor_theme'] == 'ttcn' %}
                <option value="ttcn" selected>TTCN</option>
                {% else %}
                <option value="ttcn">TTCN</option>
                {% endif %}

                {% if session['editor_theme'] == 'twilight' %}
                <option value="twilight" selected>Twilight</option>
                {% else %}
                <option value="twilight">Twilight</option>
                {% endif %}

                {% if session['editor_theme'] == 'vibrant-ink' %}
                <option value="vibrant-ink" selected>Vibrant Ink</option>
                {% else %}
                <option value="vibrant-ink">Vibrant Ink</option>
                {% endif %}

                {% if session['editor_theme'] == 'xq-dark' %}
                <option value="xq-dark" selected>XQ Dark</option>
                {% else %}
                <option value="xq-dark">XQ Dark</option>
                {% endif %}

                {% if session['editor_theme'] == 'xq-light' %}
                <option value="xq-light" selected>XQ Light</option>
                {% else %}
                <option value="xq-light">XQ Light</option>
                {% endif %}

                {% if session['editor_theme'] == 'yeti' %}
                <option value="yeti" selected>Yeti</option>
                {% else %}
                <option value="yeti">Yeti</option>
                {% endif %}

                {% if session['editor_theme'] == 'zenburn' %}
                <option value="zenburn" selected>Zenburn</option>
                {% else %}
                <option value="zenburn">Zenburn</option>
                {% endif %}

            </select>
            <label class="white-text">Choose Theme</label>
        </div>
    </div>

    <div class="row">
        <div class="col s12">
            <textarea name="snippet_content" id="snippet-content">
def to_bit_generator(secret_message):
    for c in (secret_message):
        o = ord(c)
            for i in range(8):
                yield (o & (1 << i))>> i

    hidden_message = to_bit_generator(secret_message)
    image_path = 'static/app/steganographer/images/secret_picture/virtualzero_logo.png'
    image_to_hide_message_in = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)

    for h in range(len(image_to_hide_message_in)):
        for w in range(len(image_to_hide_message_in[0])):
            try:
                image_to_hide_message_in[h][w] = image_to_hide_message_in[h][w] & ~1 | next(hidden_message)

            except StopIteration:
                continue                         </textarea>
        </div>
    </div>

    <div class="row" id="theme-save-row" style="display: none;">
        <div class="col s12">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button type='submit' class="right transparent darken-1 waves-effect waves-purple btn-flat white-text no-right-padding"
                id="personal-done-button">Save</button>
            <a href="#" onclick="cancelThemeChange()" class="btn-flat transparent right white-text">Cancel</a>
        </div>
    </div>
</form>

<script>
    document.getElementById('done-button-row').style.display = "block";
</script>

<script>
    var editor = CodeMirror.fromTextArea(document.getElementById('snippet-content'), {
        lineNumbers: true,
        readOnly: 'nocursor',
        indentUnit: 4,
        mode: 'python',
        theme: "{{ session['editor_theme'] }}"
    });
</script>

<script>
    function cancelThemeChange() {
        $.ajax({
            url: '/cancel-theme-change',
            type: 'get',
            success: function (response) {
                $('#choose-theme-form-section').html(response);
            }
        })
    }
</script>

<script>
    function saveTheme(user_id) {
        $.ajax({
            url: '/save-theme?user_id=' + user_id,
            type: 'get',
            success: function (response) {
                $('#personal-info-section').html(response);
            }
        })
    }
</script>

<script>
    var elems = document.querySelectorAll('select');
    var instances = M.FormSelect.init(elems);
</script>

<script type="text/javascript">
    function updateTheme() {
        var selectBox = document.getElementById("theme");
        var selectedTheme = selectBox.options[selectBox.selectedIndex].value;
        editor.setOption("theme", selectedTheme);

        document.getElementById('done-button-row').style.display = 'none';
        document.getElementById('theme-save-row').style.display = 'block';
    }
</script>

<script>
    $('#save-theme-form').on('submit', function (e) {
        e.preventDefault();

        document.getElementById('theme-save-row').style.display = 'none';
        document.getElementById('done-button-row').style.display = 'block';

        new_save_theme_request = $.ajax({
            url: '/save-theme?user_id={{ session["user_id"] }}',
            type: 'POST',
            data: $('#save-theme-form').serialize(),
            success: M.toast({ html: '<p>Theme Updated!</p>', classes: 'grey darken-3 white-text flow-text button-border-purple z-depth-5' })
        });

        var csrf_token = "{{ csrf_token() }}";

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrf_token);
                }
            }
        });
    });
</script>